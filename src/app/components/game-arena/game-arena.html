@if (gameState()) {
  <div class="arena-container">
    <!-- Ranking Panel -->
    <app-ranking-panel
      [isVisible]="isRankingPanelVisible()"
      (close)="hideRankingPanel()"
      (export)="showMessage('Partie exportée !')"
    >
    </app-ranking-panel>

    <!-- Ranking Trigger Button -->
    <button
      class="ranking-trigger-btn"
      (click)="toggleRankingPanel()"
      [class.active]="isRankingPanelVisible()"
      *ngIf="!isRankingPanelVisible()"
    >
      <mat-icon>emoji_events</mat-icon>
    </button>

    <!-- Header -->
    <div class="arena-header">
      <div class="header-left">
        <button
          mat-icon-button
          class="back-btn"
          (click)="backToSetup()"
          matTooltip="Retour à la configuration"
        >
          <mat-icon>arrow_back</mat-icon>
        </button>
        <h1>Ronde des Carrés - Manche {{ currentSet() }}</h1>
      </div>

      <!-- Timer Component -->
      <app-timer
        [remainingTime]="remainingTime()"
        [isRunning]="isTimerRunning()"
        (start)="startRound()"
        (stop)="stopRound()"
      ></app-timer>
    </div>

    <!-- Courts Grid -->
    <div class="courts-grid">
      @for (court of gameState()!.courts; track court.id) {
        <app-court-card
          [court]="court"
          [score]="matchScores()[court.id]"
          [getPlayerDisplayName]="getPlayerDisplayName.bind(this)"
          (scoreChange)="onScoreChange($event)"
        ></app-court-card>
      }
    </div>

    <!-- Waiting Queue -->
    @if (waitingPlayers().length > 0) {
      <app-waiting-queue
        [players]="waitingPlayers()"
        [getPlayerDisplayName]="getPlayerDisplayName.bind(this)"
      ></app-waiting-queue>
    }

    <!-- Arena Controls -->
    <app-arena-controls
      [isTimerRunning]="isTimerRunning()"
      (shuffle)="shufflePlayers()"
      (nextRound)="nextRound()"
      (endGame)="endGame()"
    ></app-arena-controls>
  </div>
}
